<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Interior VR View</title>
<style>
body { margin:0; overflow:hidden; }
</style>
</head>

<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>

<script>

const params = new URLSearchParams(window.location.search);
const imgData = decodeURIComponent(params.get("img"));

const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
75,
window.innerWidth/window.innerHeight,
1,
1100
);

const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const geometry = new THREE.SphereGeometry(500,60,40);
geometry.scale(-1,1,1);

const texture = new THREE.TextureLoader().load(
"data:image/png;base64," + imgData
);

const material = new THREE.MeshBasicMaterial({ map:texture });

const mesh = new THREE.Mesh(geometry, material);
scene.add(mesh);

let lon = 0, lat = 0;
let isUserInteracting = false;
let startX, startY;

document.addEventListener("pointerdown", e=>{
isUserInteracting=true;
startX=e.clientX;
startY=e.clientY;
});

document.addEventListener("pointermove", e=>{
if(isUserInteracting){
lon += (e.clientX-startX)*0.1;
lat += (e.clientY-startY)*0.1;
}
});

document.addEventListener("pointerup", ()=>isUserInteracting=false);

function animate(){
requestAnimationFrame(animate);

lat=Math.max(-85,Math.min(85,lat));
const phi=THREE.MathUtils.degToRad(90-lat);
const theta=THREE.MathUtils.degToRad(lon);

camera.lookAt(
500*Math.sin(phi)*Math.cos(theta),
500*Math.cos(phi),
500*Math.sin(phi)*Math.sin(theta)
);

renderer.render(scene,camera);
}

animate();

</script>
</body>
</html>